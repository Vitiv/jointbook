# jointbook
Telegram bookstore-bot for Minter network users

Телеграм-бот книжного магазина.
Возможности:

- открывает кошельки новым пользователям;
- позволяет пополнять кошелек через QIWI;
- продает книги, выложенные через админ-панель;
- принимает оплату в BIP;
- позволяет скачать приобретенные книги;
- зачисляет выручку на кошелек книги;
- регулярно переводит выручку с кошелька книги на главный кошелек магазина

Бот работает на Node.js с базой данных PostgreSQL.
Установка бота на LINUX сервер:

- Рекомендуется загрузить копию файлов на ваш LINUX сервер, например, Ubuntu 16.04, и установить БД PostgreSQL.
- Создать базу данных и ее пользователя, сохранить эти данные.
- Через Телеграм-бота BotFather создать своего бота, сохранить его токен.
- Для изменения всех параметров (telegram bot token, qiwi secretKey, qiwi publicKey, adminPanel credentials) нужно изменить файл debug.json.

Для этого необходимо в корне проекта ввести команду:

nano config/debug.json

Заполните нужными данными поля:
"token": "YOUR_TOKEN" - токен бота из BotFather
"dbConfig":
"dbName": "YOUR_DB_NAME" - имя вашей БД
"userName": "YOUR_DB_USERNAME" - имя пользователя вашей БД
"password": "YOUR_DB_PASSWORD" - пароль пользователя вашей БД
"credentials": {
"login": "YOUR_ADMIN_USERNAME" - логин вашего администратора (добавление/удаление авторов и книг, выкладка книг)
"password": "YOUR_ADMIN_PASSWORD" - пароль администратора
},
"qiwi": {
"secretKey": "YOUR_QIWI_SECRET_KEY" - секретный ключ вашего QIWI-кошелька
"publicKey": "YOUR_QIWI_PUBLIC_KEY" - открытый ключ вашего QIWI-кошелька
},
"mainWalletMnemonic": "12_WORDS_SEED_PHRASE" - сид-фраза главного кошелька бота
"bipRate": 1 - курс обмена QIWI на BIP
"bitsCost": { - предлагаемые пользователю объемы пополнения кошелька в рублях, по умолчанию 1, 5 и 10 рублей
"1": 1,
"5": 5,
"10": 10
},
"billDurationMillis": 1800000 - время жизни счета QIWI
"ownerTelegramId": - ID владельца бота
}

Установка зависимостей бота:

npm install

Для запуска под LINUX необходимо в корне проекта написать команду:

sudo NODE_ENV=debug node index.js & disown


Зайдите на IP вашего сервера и вы попадете на страницу администратора (придется ввести установленный вами в файле debug.json логин и пароль администратора).
Там вы сможете добавить авторов и книги, а также открыть книги для продажи.

Заходите в вашего бота и увидете выставленные через панель администратора книги.

Дополнительные настройки:

Языки: В корне проекта лежит папка languages. В ней лежат файлы с языками.
Чтоб добавить свой язык, необходимо взять любой из файлов из этой папки и скопировать его, назвав инициалами языка
(ВАЖНО: необходимо указывать название файла 2-3 буквами, которые также необходимо использовать внутри этого файла в строке "code":
"EN" (регистр не имеет значения)). Далее необходимо заполнить все поля созданного файла на том языке, который добавляется.

Ручная работа с БД:
Для подключения к БД ввести команду:
psql
Далее необходимо подключиться к пользователю: \c ИМЯ

Просмотр таблиц: \dt
Просмотр данных из таблицы: select * from <table_name>;

Изменять данные вручную крайне не рекомендуется.
